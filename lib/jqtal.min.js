(function($){var methods={};methods.init=function(a){var b=[];$(this).find("[data-repeat]").each(function(){var c=$(this),d=c.data("repeat"),e=methods.scope(c,a,!1),f=methods.resolve(d,e),g=!1,h=c.parent()[0];for(var i=0;i<b.length;i++)if(b[i][0]==h&&b[i][1]==d){g=!0;break}g||b.push([c.parent(),d,f])});for(var c=0;c<b.length;c++){var d=b[c][0],e=b[c][1],f=b[c][2],g;while((g=$(d).find("[data-repeat="+e+"]")).length<f.length)g.eq(0).clone().insertAfter(g.eq(g.length-1));while((g=$(d).find("[data-repeat="+e+"]")).length>f.length)g.eq(g.length-1).remove()}var h=function(b,c,d){$(b).find("[data-"+c+"]").each(function(){var b=$(this),e=b.data(c),f=methods.scope(b,a);d(b,e,f)})};h(this,"content",function(a,b,c){a.text(methods.resolve(b,c))}),h(this,"attr",function(a,b,c){var d=b.split("=");a.attr(d[0],methods.resolve(d[1],c))}),h(this,"val",function(a,b,c){var d=methods.resolve(b,c);(new String(a.attr("type"))).match(/checkbox|radio/i)?a.attr("checked",a.val()==d):a.val(d)});return this},methods.resolve=function(instruction,scope,modify_scope){modify_scope||(scope=scope.slice(0));if(instruction.match(/^js:/)){var prop=function(a){return methods.resolve(a,scope)},js=instruction.replace(/^js:/,"");value=eval("(function(prop) { "+js+" })(prop)"),scope.unshift(value)}else{var parts=instruction.replace(/\([^\)]*\)/,"").split("/"),value;for(var i=0;i<parts.length;i++){if(parts[i]==".")continue;parts[i]==".."?scope.splice(0,1):parts[i]==""?scope.splice(0,scope.length-1):(value=scope[0][parts[i]],typeof value=="function"?value=value():typeof scope[0].get=="function"&&(value=scope[0].get(parts[i])),scope.unshift(value))}}return scope[0]},methods.scope=function(a,b,c){var d=[b],e=function(a,b){var b=$(b),e,f;(e=b.data("scope"))&&methods.resolve(e,d,!0);if(c!==!1&&(f=b.data("repeat"))){var g=b.prevAll("[data-repeat="+f+"]").length;methods.resolve(f+"/"+g,d,!0)}};$(a.parents("[data-scope], [data-repeat]").get().reverse()).each(e),e(-1,a);return d},$.fn.tal=function(a){return methods[a]?methods[a].apply(this,Array.prototype.slice.call(arguments,1)):methods.init.apply(this,arguments)}})(jQuery)