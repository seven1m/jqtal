(function(a){var b={};b.init=function(c){var d=[];a(this).find("[data-repeat]").each(function(){var e=a(this),f=e.data("repeat"),g=b.scope(e,c,!1),h=b.resolve(f,g),i=!1,j=e.parent()[0];for(var k=0;k<d.length;k++)if(d[k][0]==j&&d[k][1]==f){i=!0;break}i||d.push([e.parent(),f,h])});for(var e=0;e<d.length;e++){var f=d[e][0],g=d[e][1],h=d[e][2],i;while((i=a(f).find("[data-repeat="+g+"]")).length<h.length)i.eq(0).clone().insertAfter(i.eq(i.length-1));while((i=a(f).find("[data-repeat="+g+"]")).length>h.length)i.eq(i.length-1).remove()}var j=function(d,e,f){a(d).find("[data-"+e+"]").each(function(){var d=a(this),g=d.data(e),h=b.scope(d,c);f(d,g,h)})};j(this,"content",function(a,c,d){a.text(b.resolve(c,d))}),j(this,"attr",function(a,c,d){var e=c.split("=");a.attr(e[0],b.resolve(e[1],d))}),j(this,"val",function(a,c,d){var e=b.resolve(c,d);(new String(a.attr("type"))).match(/checkbox|radio/i)?a.attr("checked",a.val()==e):a.val(e)});return this},b.resolve=function(a,b,c){c||(b=b.slice(0));var d=a.split("/"),e;for(var f=0;f<d.length;f++){if(d[f]==".")continue;d[f]==".."?b.splice(0,1):d[f]==""?b.splice(0,b.length-1):(e=b[0][d[f]],b.unshift(e))}return b[0]},b.scope=function(c,d,e){var f=[d],g=function(c,d){var d=a(d),g,h;(g=d.data("scope"))&&b.resolve(g,f,!0);if(e!==!1&&(h=d.data("repeat"))){var i=d.prevAll("[data-repeat="+h+"]").length;b.resolve(h+"/"+i,f,!0)}};a(c.parents("[data-scope], [data-repeat]").get().reverse()).each(g),g(-1,c);return f},a.fn.tal=function(a){return b[a]?b[a].apply(this,Array.prototype.slice.call(arguments,1)):b.init.apply(this,arguments)}})(jQuery)